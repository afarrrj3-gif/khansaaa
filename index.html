<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Telegram iOS Final Stable</title>

<style>
body{
margin:0;
height:100vh;
display:flex;
flex-direction:column;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:url('https://res.cloudinary.com/dtdodhqqi/image/upload/v1771310542/c36725a5a2a254a5df8c7dd4bdaa05af_v3tzna.jpg');
background-size:cover;
background-position:center;
}

*{
-webkit-user-select:none;
user-select:none;
}

#chatArea{
flex:1;
overflow-y:auto;
padding:12px;
display:flex;
flex-direction:column;
gap:4px; /* lebih rapet */
}

@keyframes bubbleIn{
0%{transform:translateX(25px) scale(.9);opacity:0;}
100%{transform:translateX(0) scale(1);opacity:1;}
}

@keyframes popupIn{
0%{transform:translate(-50%,-50%) scale(.7);opacity:0;}
100%{transform:translate(-50%,-50%) scale(1);opacity:1;}
}

@keyframes slideUp{
0%{transform:translateY(100%);opacity:0;}
100%{transform:translateY(0);opacity:1;}
}
</style>
</head>

<body oncontextmenu="return false">

<div id="chatArea"></div>
<input type="file" id="fileInput" accept="image/*" style="display:none">

<!-- KOLOM KETIK (TIDAK DIUBAH 1px) -->
<div style="padding:10px 12px; position:relative; z-index:5;">
<div style="display:flex;align-items:center;background:#1f2c34;border-radius:999px;height:44px;padding:0 12px;box-shadow:0 4px 12px rgba(0,0,0,0.45),inset 0 1px 0 rgba(255,255,255,0.05);">

<svg onclick="toggleEmoji()" viewBox="0 0 24 24"
fill="none" stroke="#2AABEE" stroke-width="2"
stroke-linecap="round" stroke-linejoin="round"
style="width:24px;height:24px;transform:scale(1.8);margin-right:16px;cursor:pointer;">
<circle cx="12" cy="12" r="9"/>
<circle cx="9" cy="10" r="0.8" fill="#2AABEE" stroke="none"/>
<circle cx="15" cy="10" r="0.8" fill="#2AABEE" stroke="none"/>
<path d="M8 14c2.2 2.4 5.8 2.4 8 0"/>
</svg>

<input id="msgInput" type="text" placeholder="Message"
style="flex:1;border:none;outline:none;background:transparent;color:white;font-size:16px;height:100%;">

<svg onclick="document.getElementById('fileInput').click()" viewBox="0 0 24 24"
fill="none" stroke="#2AABEE" stroke-width="2"
stroke-linecap="round" stroke-linejoin="round"
style="width:24px;height:24px;transform:scale(1.8);margin-right:8px;cursor:pointer;">
<path d="M7 13l6-6a3 3 0 114 4l-8 8a5 5 0 11-7-7l9-9"/>
</svg>

<div onclick="sendMessage()" style="width:44px;height:44px;min-width:44px;min-height:44px;flex-shrink:0;background:#2AABEE;border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.4);">
<svg width="22" height="22" viewBox="0 0 24 24" fill="white">
<path d="M3 20l18-8-18-8v6l13 2-13 2z"/>
</svg>
</div>

</div>
</div>

<!-- EMOJI PANEL -->
<div id="emojiPanel" style="display:none;background:rgba(0,0,0,.6);backdrop-filter:blur(12px);padding:12px;animation:slideUp .25s ease;">
<span onclick="addEmoji('üò≠')" style="font-size:26px;margin:8px;cursor:pointer;">üò≠</span>
<span onclick="addEmoji('üòÇ')" style="font-size:26px;margin:8px;cursor:pointer;">üòÇ</span>
<span onclick="addEmoji('‚ù§Ô∏è')" style="font-size:26px;margin:8px;cursor:pointer;">‚ù§Ô∏è</span>
<span onclick="addEmoji('üëç')" style="font-size:26px;margin:8px;cursor:pointer;">üëç</span>
</div>

<div id="overlay" style="position:fixed;inset:0;display:none;background:rgba(0,0,0,.4);backdrop-filter:blur(12px);z-index:10;"></div>

<script>
const chatArea=document.getElementById("chatArea");
const input=document.getElementById("msgInput");
const fileInput=document.getElementById("fileInput");
const overlay=document.getElementById("overlay");

function getTime(){
const d=new Date();
return d.getHours().toString().padStart(2,'0')+":"+d.getMinutes().toString().padStart(2,'0');
}

function sendMessage(){
if(input.value.trim()==="") return;
createBubble(input.value,false);
input.value="";
}

function createBubble(content,isImage){

const bubble=document.createElement("div");
bubble.style.alignSelf="flex-end";
bubble.style.background="#248C46";
bubble.style.color="white";
bubble.style.borderRadius="18px";
bubble.style.maxWidth="75%";
bubble.style.animation="bubbleIn .2s cubic-bezier(.34,1.56,.64,1)";
bubble.style.position="relative";
bubble.style.overflow="hidden";
bubble.style.padding=isImage?"2px":"8px 12px";

if(isImage){
const img=document.createElement("img");
img.src=content;
img.style.width="100%";
img.style.display="block";
img.style.borderRadius="16px";
bubble.appendChild(img);
}

if(!isImage){
const text=document.createElement("span");
text.textContent=content;
bubble.appendChild(text);
}

const meta=document.createElement("div");
meta.style.position=isImage?"absolute":"static";
meta.style.right=isImage?"6px":"";
meta.style.bottom=isImage?"6px":"";
meta.style.fontSize="11px";
meta.style.opacity=".9";
meta.style.color="white";
meta.innerHTML=getTime()+` <span class="check" style="color:rgba(255,255,255,.6)">‚úî‚úî</span>`;

bubble.appendChild(meta);

chatArea.appendChild(bubble);
chatArea.scrollTop=chatArea.scrollHeight;

setTimeout(()=>{
meta.querySelector(".check").style.transition="color .3s ease";
meta.querySelector(".check").style.color="#4FC3F7";
},2000);

/* LONG PRESS FIXED */
let timer;
bubble.addEventListener("pointerdown",()=>{
timer=setTimeout(()=>showPopup(bubble),400);
});
bubble.addEventListener("pointerup",()=>clearTimeout(timer));
}

fileInput.onchange=function(e){
const reader=new FileReader();
reader.onload=function(){
createBubble(reader.result,true);
}
reader.readAsDataURL(e.target.files[0]);
}

function showPopup(bubble){
overlay.style.display="block";

const menu=document.createElement("div");
menu.style.position="fixed";
menu.style.left="50%";
menu.style.top="50%";
menu.style.transform="translate(-50%,-50%)";
menu.style.background="white";
menu.style.borderRadius="18px";
menu.style.padding="12px";
menu.style.width="220px";
menu.style.animation="popupIn .2s ease";
menu.style.zIndex="20";

menu.innerHTML=`
<div onclick="deleteMsg()" style="padding:10px;color:red;">Delete</div>
<hr>
<div onclick="editMsg()" style="padding:10px;">Edit</div>
<hr>
<div onclick="closePopup()" style="padding:10px;">Batal</div>
`;

document.body.appendChild(menu);
window.currentBubble=bubble;
window.currentMenu=menu;
}

function closePopup(){
overlay.style.display="none";
if(window.currentMenu) document.body.removeChild(window.currentMenu);
}

function deleteMsg(){
window.currentBubble.innerHTML="Pesan telah dihapus";
closePopup();
}

function editMsg(){
const t=prompt("Edit pesan:");
if(t) window.currentBubble.firstChild.textContent=t;
closePopup();
}

function toggleEmoji(){
const p=document.getElementById("emojiPanel");
p.style.display=p.style.display==="none"?"block":"none";
}

function addEmoji(e){
input.value+=e;
}
</script>

</body>
</html>
